<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Shelf - Your Daily Puzzle Hub</title>
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --bg-primary: #1a1a2e;
            --bg-secondary: #16213e;
            --bg-card: #1f2940;
            --bg-hover: #2a3a5a;
            --accent-gold: #f4d35e;
            --accent-green: #4ade80;
            --accent-blue: #60a5fa;
            --accent-red: #f87171;
            --accent-purple: #a78bfa;
            --accent-orange: #fb923c;
            --accent-pink: #f472b6;
            --text-primary: #f0f0f0;
            --text-secondary: #a0a0a0;
            --text-muted: #6b7280;
        }

        body {
            font-family: 'Nunito', sans-serif;
            background: var(--bg-primary);
            min-height: 100vh;
            color: var(--text-primary);
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
        }

        /* Header */
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--bg-secondary);
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 5px;
        }

        .header .tagline {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        /* Navigation Tabs */
        .nav-tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 25px;
            background: var(--bg-secondary);
            padding: 5px;
            border-radius: 12px;
            overflow-x: auto;
        }

        .nav-tab {
            flex: 1;
            min-width: 80px;
            padding: 12px 15px;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: var(--text-secondary);
            font-family: inherit;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .nav-tab:hover {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .nav-tab.active {
            background: var(--accent-gold);
            color: #000;
        }

        /* Tab Content */
        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        /* Stats Bar */
        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 25px;
            padding: 15px;
            background: var(--bg-secondary);
            border-radius: 12px;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--accent-gold);
        }

        .stat-label {
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Section Headers */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 25px 0 15px;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .add-btn {
            background: var(--bg-hover);
            border: 2px dashed var(--text-muted);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-family: inherit;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .add-btn:hover {
            border-color: var(--accent-gold);
            color: var(--accent-gold);
        }

        /* Game Grid */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
            gap: 15px;
        }

        .game-card {
            background: var(--bg-card);
            border-radius: 16px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            border: 2px solid transparent;
        }

        .game-card:hover {
            background: var(--bg-hover);
            transform: translateY(-3px);
        }

        .game-card.played-today {
            border-color: var(--accent-green);
        }

        .game-card .icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
            display: block;
        }

        .game-card .name {
            font-weight: 700;
            font-size: 1rem;
            margin-bottom: 5px;
        }

        .game-card .streak {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        .game-card .streak.active {
            color: var(--accent-gold);
        }

        .game-card .check-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--accent-green);
            color: #000;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .game-card .remove-btn {
            position: absolute;
            top: 8px;
            left: 8px;
            background: rgba(0,0,0,0.3);
            border: none;
            color: var(--text-muted);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 0.7rem;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .game-card:hover .remove-btn {
            opacity: 1;
        }

        .game-card .remove-btn:hover {
            background: var(--accent-red);
            color: #fff;
        }

        .game-card .rating {
            margin-top: 5px;
        }

        .game-card .rating .star {
            color: var(--text-muted);
            font-size: 0.9rem;
        }

        .game-card .rating .star.filled {
            color: var(--accent-gold);
        }

        /* Featured Games (RB Games) */
        .featured-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(170px, 1fr));
            gap: 15px;
        }

        .featured-card {
            background: linear-gradient(135deg, var(--bg-card), var(--bg-hover));
            border: 2px solid var(--accent-purple);
            border-radius: 16px;
            padding: 20px 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
        }

        .featured-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(167, 139, 250, 0.2);
        }

        .featured-card.played-today {
            border-color: var(--accent-green);
        }

        .featured-badge {
            position: absolute;
            top: -8px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent-purple);
            color: #000;
            font-size: 0.65rem;
            font-weight: 700;
            padding: 2px 8px;
            border-radius: 4px;
            text-transform: uppercase;
        }

        /* New Game Spotlight */
        .spotlight-card {
            background: linear-gradient(135deg, var(--bg-secondary), var(--bg-card));
            border: 2px solid var(--accent-orange);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .spotlight-card .icon {
            font-size: 4rem;
        }

        .spotlight-card .info {
            flex: 1;
        }

        .spotlight-card .badge {
            background: var(--accent-orange);
            color: #000;
            font-size: 0.7rem;
            font-weight: 700;
            padding: 3px 10px;
            border-radius: 4px;
            text-transform: uppercase;
            display: inline-block;
            margin-bottom: 8px;
        }

        .spotlight-card h3 {
            font-size: 1.4rem;
            margin-bottom: 5px;
        }

        .spotlight-card p {
            color: var(--text-secondary);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .spotlight-card .btn {
            padding: 10px 20px;
        }

        /* Community Links */
        .community-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }

        .community-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
            cursor: pointer;
            transition: all 0.2s;
            text-decoration: none;
            color: inherit;
        }

        .community-card:hover {
            background: var(--bg-hover);
            transform: translateY(-2px);
        }

        .community-card .icon {
            font-size: 2rem;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 12px;
        }

        .community-card.discord .icon { background: #5865F2; }
        .community-card.reddit .icon { background: #FF4500; }
        .community-card.twitter .icon { background: #1DA1F2; }
        .community-card.facebook .icon { background: #1877F2; }
        .community-card.youtube .icon { background: #FF0000; }
        .community-card.tiktok .icon { background: #000000; }
        .community-card.threads .icon { background: #000000; }
        .community-card.bluesky .icon { background: #0085FF; }
        .community-card.mastodon .icon { background: #6364FF; }

        .community-card .info h4 {
            font-size: 1rem;
            margin-bottom: 3px;
        }

        .community-card .info p {
            font-size: 0.8rem;
            color: var(--text-muted);
        }

        /* Reviews Section */
        .review-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 15px;
        }

        .review-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }

        .review-header .icon {
            font-size: 2.5rem;
        }

        .review-header .info h4 {
            font-size: 1.1rem;
        }

        .review-header .stars {
            color: var(--accent-gold);
        }

        .review-notes {
            background: var(--bg-secondary);
            border-radius: 8px;
            padding: 15px;
            color: var(--text-secondary);
            font-size: 0.9rem;
            min-height: 60px;
        }

        .review-notes:empty::before {
            content: 'No notes yet. Click to add...';
            color: var(--text-muted);
            font-style: italic;
        }

        .review-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        /* Discover Grid */
        .discover-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .discover-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .discover-card:hover {
            background: var(--bg-hover);
        }

        .discover-card .header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .discover-card .icon {
            font-size: 2rem;
        }

        .discover-card .name {
            font-weight: 700;
        }

        .discover-card .source {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .discover-card .description {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 10px;
        }

        .discover-card .tags {
            display: flex;
            gap: 5px;
            flex-wrap: wrap;
        }

        .discover-card .tag {
            background: var(--bg-secondary);
            padding: 3px 8px;
            border-radius: 4px;
            font-size: 0.7rem;
            color: var(--text-muted);
        }

        /* Modal Overlay */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal {
            background: var(--bg-secondary);
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            padding: 30px;
        }

        .modal h2 {
            color: var(--accent-gold);
            margin-bottom: 10px;
            font-size: 1.5rem;
        }

        .modal p {
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
        }

        /* Game List in Registration */
        .game-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 20px;
            max-height: 300px;
            overflow-y: auto;
        }

        .game-list-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            background: var(--bg-card);
            border-radius: 10px;
            cursor: pointer;
            transition: background 0.2s;
        }

        .game-list-item:hover {
            background: var(--bg-hover);
        }

        .game-list-item.selected {
            background: var(--bg-hover);
            border: 2px solid var(--accent-green);
        }

        .game-list-item .icon {
            font-size: 1.5rem;
        }

        .game-list-item .info {
            flex: 1;
        }

        .game-list-item .name {
            font-weight: 600;
        }

        .game-list-item .source {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .game-list-item .checkbox {
            width: 24px;
            height: 24px;
            border: 2px solid var(--text-muted);
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: transparent;
            transition: all 0.2s;
        }

        .game-list-item.selected .checkbox {
            background: var(--accent-green);
            border-color: var(--accent-green);
            color: #000;
        }

        /* Form Inputs */
        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            color: var(--text-secondary);
            font-size: 0.9rem;
        }

        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px 15px;
            background: var(--bg-card);
            border: 2px solid var(--bg-hover);
            border-radius: 10px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 1rem;
        }

        .form-group textarea {
            min-height: 100px;
            resize: vertical;
        }

        .form-group input:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-gold);
        }

        /* Star Rating Input */
        .star-rating-input {
            display: flex;
            gap: 5px;
        }

        .star-rating-input .star {
            font-size: 1.8rem;
            color: var(--text-muted);
            cursor: pointer;
            transition: color 0.2s;
        }

        .star-rating-input .star:hover,
        .star-rating-input .star.filled {
            color: var(--accent-gold);
        }

        /* Buttons */
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 10px;
            font-family: inherit;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--accent-gold);
            color: #000;
        }

        .btn-primary:hover {
            filter: brightness(1.1);
        }

        .btn-secondary {
            background: var(--bg-hover);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--bg-card);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 0.85rem;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-muted);
        }

        .empty-state .icon {
            font-size: 3rem;
            margin-bottom: 15px;
        }

        /* Footer */
        .footer {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 1px solid var(--bg-secondary);
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        /* Settings Button */
        .settings-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--bg-secondary);
            border: none;
            color: var(--text-secondary);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3);
            transition: all 0.2s;
        }

        .settings-btn:hover {
            background: var(--bg-hover);
            color: var(--accent-gold);
        }

        /* Responsive */
        @media (max-width: 600px) {
            .header h1 {
                font-size: 2rem;
            }

            .stats-bar {
                gap: 15px;
            }

            .stat-value {
                font-size: 1.4rem;
            }

            .game-grid, .featured-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .nav-tabs {
                gap: 3px;
            }

            .nav-tab {
                padding: 10px 8px;
                font-size: 0.8rem;
            }

            .spotlight-card {
                flex-direction: column;
                text-align: center;
            }

            .community-grid {
                grid-template-columns: 1fr;
            }

            .share-preview {
                padding: 15px;
            }

            .share-games-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        /* RSS List */
        .rss-list {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .rss-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 15px;
            background: var(--bg-card);
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .rss-item:hover {
            background: var(--bg-hover);
        }

        .rss-icon {
            font-size: 1.5rem;
        }

        .rss-info {
            flex: 1;
        }

        .rss-name {
            font-weight: 600;
            font-size: 0.95rem;
        }

        .rss-url {
            font-size: 0.75rem;
            color: var(--text-muted);
            font-family: monospace;
        }

        .copy-btn {
            background: var(--bg-hover);
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 0.8rem;
            color: var(--text-secondary);
            transition: all 0.2s;
        }

        .rss-item:hover .copy-btn {
            background: var(--accent-gold);
            color: #000;
        }

        /* Chat/Discussion */
        .chat-container {
            background: var(--bg-card);
            border-radius: 12px;
            overflow: hidden;
        }

        .chat-messages {
            max-height: 300px;
            overflow-y: auto;
            padding: 15px;
        }

        .chat-message {
            background: var(--bg-secondary);
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 10px;
        }

        .chat-message:last-child {
            margin-bottom: 0;
        }

        .chat-message-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
        }

        .chat-message-time {
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .chat-message-text {
            font-size: 0.9rem;
            color: var(--text-primary);
            line-height: 1.4;
        }

        .chat-message-delete {
            background: none;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .chat-message:hover .chat-message-delete {
            opacity: 1;
        }

        .chat-message-delete:hover {
            color: var(--accent-red);
        }

        .chat-input-container {
            display: flex;
            gap: 10px;
            padding: 15px;
            background: var(--bg-secondary);
            border-top: 1px solid var(--bg-hover);
        }

        .chat-input-container input {
            flex: 1;
            padding: 10px 15px;
            background: var(--bg-card);
            border: 2px solid var(--bg-hover);
            border-radius: 8px;
            color: var(--text-primary);
            font-family: inherit;
            font-size: 0.9rem;
        }

        .chat-input-container input:focus {
            outline: none;
            border-color: var(--accent-gold);
        }

        .chat-empty {
            text-align: center;
            padding: 30px;
            color: var(--text-muted);
        }

        /* Share Shelf */
        .share-section {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid var(--bg-secondary);
        }

        .share-preview {
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border-radius: 16px;
            padding: 25px;
            margin-bottom: 20px;
            border: 2px solid var(--accent-purple);
        }

        .share-preview-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .share-preview-header h3 {
            font-size: 1.5rem;
            background: linear-gradient(135deg, var(--accent-gold), var(--accent-purple));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .share-preview-header p {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .share-stats-row {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-bottom: 20px;
        }

        .share-stat {
            text-align: center;
        }

        .share-stat-value {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--accent-gold);
        }

        .share-stat-label {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
        }

        .share-games-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .share-game-item {
            background: var(--bg-card);
            border-radius: 10px;
            padding: 12px 8px;
            text-align: center;
        }

        .share-game-item .icon {
            font-size: 1.5rem;
            display: block;
            margin-bottom: 5px;
        }

        .share-game-item .name {
            font-size: 0.7rem;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .share-game-item .streak {
            font-size: 0.65rem;
            color: var(--accent-gold);
        }

        .share-footer {
            text-align: center;
            font-size: 0.75rem;
            color: var(--text-muted);
        }

        .share-buttons {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .share-buttons .btn {
            flex: 1;
            min-width: 120px;
        }

        /* Toast notification */
        .toast {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--accent-green);
            color: #000;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            z-index: 2000;
            opacity: 0;
            transition: opacity 0.3s;
            pointer-events: none;
        }

        .toast.show {
            opacity: 1;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>üéÆ Game Shelf</h1>
            <p class="tagline">Your Daily Puzzle Hub</p>
        </header>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab active" onclick="switchTab('games')">üéØ Games</button>
            <button class="nav-tab" onclick="switchTab('discover')">üîç Discover</button>
            <button class="nav-tab" onclick="switchTab('reviews')">‚≠ê Reviews</button>
            <button class="nav-tab" onclick="switchTab('community')">üí¨ Community</button>
        </div>

        <!-- Games Tab -->
        <div class="tab-content active" id="tab-games">
            <div class="stats-bar">
                <div class="stat-item">
                    <div class="stat-value" id="today-count">0</div>
                    <div class="stat-label">Played Today</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="best-streak">0</div>
                    <div class="stat-label">Best Streak</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="total-games">0</div>
                    <div class="stat-label">Games</div>
                </div>
            </div>

            <!-- Featured Games (Your Games) -->
            <div class="section-header">
                <span class="section-title">‚≠ê Featured</span>
            </div>
            <div class="featured-grid" id="featured-games"></div>

            <!-- Other Games -->
            <div class="section-header">
                <span class="section-title">üìö My Games</span>
                <button class="add-btn" onclick="showAddGameModal()">+ Add Game</button>
            </div>
            <div class="game-grid" id="my-games"></div>

            <!-- Share Your Shelf -->
            <div class="share-section">
                <div class="section-header">
                    <span class="section-title">üì§ Share Your Shelf</span>
                </div>
                <div class="share-preview" id="share-preview">
                    <div class="share-preview-header">
                        <h3>üéÆ My Game Shelf</h3>
                        <p id="share-date"></p>
                    </div>
                    <div class="share-stats-row">
                        <div class="share-stat">
                            <div class="share-stat-value" id="share-played">0</div>
                            <div class="share-stat-label">Played Today</div>
                        </div>
                        <div class="share-stat">
                            <div class="share-stat-value" id="share-streak">0</div>
                            <div class="share-stat-label">Best Streak</div>
                        </div>
                        <div class="share-stat">
                            <div class="share-stat-value" id="share-total">0</div>
                            <div class="share-stat-label">Total Games</div>
                        </div>
                    </div>
                    <div class="share-games-grid" id="share-games"></div>
                    <div class="share-footer">gameshelf.app ‚Ä¢ Your Daily Puzzle Hub</div>
                </div>
                <div class="share-buttons">
                    <button class="btn btn-primary" onclick="shareAsImage()">üì∑ Save Image</button>
                    <button class="btn btn-secondary" onclick="shareAsText()">üìã Copy Text</button>
                    <button class="btn btn-secondary" onclick="shareNative()">üì§ Share</button>
                </div>
            </div>
        </div>

        <!-- Toast Notification -->
        <div class="toast" id="toast">Copied!</div>

        <!-- Discover Tab -->
        <div class="tab-content" id="tab-discover">
            <!-- Spotlight -->
            <div class="spotlight-card" id="spotlight-game">
                <span class="icon">üÜï</span>
                <div class="info">
                    <span class="badge">üî• New This Week</span>
                    <h3>Connections</h3>
                    <p>Group 16 words into 4 categories. A viral hit from the NY Times puzzle team!</p>
                    <button class="btn btn-primary btn-small" onclick="addGameFromDiscover('connections')">+ Add to Shelf</button>
                </div>
            </div>

            <div class="section-header">
                <span class="section-title">üîç Discover New Games</span>
            </div>
            <div class="discover-grid" id="discover-list"></div>
        </div>

        <!-- Reviews Tab -->
        <div class="tab-content" id="tab-reviews">
            <div class="section-header">
                <span class="section-title">‚≠ê My Reviews & Notes</span>
            </div>
            <div id="reviews-list"></div>
            <div class="empty-state" id="reviews-empty" style="display:none;">
                <div class="icon">üìù</div>
                <p>No reviews yet.<br>Add games to your shelf and rate them!</p>
            </div>
        </div>

        <!-- Community Tab -->
        <div class="tab-content" id="tab-community">
            <div class="section-header">
                <span class="section-title">üí¨ Word Game Communities</span>
            </div>
            <div class="community-grid">
                <a href="https://discord.gg/wordgames" target="_blank" class="community-card discord">
                    <div class="icon">üí¨</div>
                    <div class="info">
                        <h4>Discord</h4>
                        <p>Join word game chat rooms</p>
                    </div>
                </a>
                <a href="https://reddit.com/r/wordle" target="_blank" class="community-card reddit">
                    <div class="icon">üî¥</div>
                    <div class="info">
                        <h4>r/wordle</h4>
                        <p>Daily Wordle discussions</p>
                    </div>
                </a>
                <a href="https://reddit.com/r/NYTGames" target="_blank" class="community-card reddit">
                    <div class="icon">üî¥</div>
                    <div class="info">
                        <h4>r/NYTGames</h4>
                        <p>All NY Times puzzles</p>
                    </div>
                </a>
                <a href="https://twitter.com/search?q=wordle" target="_blank" class="community-card twitter">
                    <div class="icon">üê¶</div>
                    <div class="info">
                        <h4>Twitter/X</h4>
                        <p>Share your results</p>
                    </div>
                </a>
                <a href="https://www.facebook.com/groups/wordlegame" target="_blank" class="community-card facebook">
                    <div class="icon">üìò</div>
                    <div class="info">
                        <h4>Facebook Groups</h4>
                        <p>Connect with players</p>
                    </div>
                </a>
                <a href="https://www.youtube.com/results?search_query=daily+word+games" target="_blank" class="community-card youtube">
                    <div class="icon">‚ñ∂Ô∏è</div>
                    <div class="info">
                        <h4>YouTube</h4>
                        <p>Tips & walkthroughs</p>
                    </div>
                </a>
                <a href="https://www.tiktok.com/search?q=wordle" target="_blank" class="community-card tiktok">
                    <div class="icon">üéµ</div>
                    <div class="info">
                        <h4>TikTok</h4>
                        <p>Short-form puzzle content</p>
                    </div>
                </a>
                <a href="https://www.threads.net/search?q=wordle" target="_blank" class="community-card threads">
                    <div class="icon">üßµ</div>
                    <div class="info">
                        <h4>Threads</h4>
                        <p>Share & discuss</p>
                    </div>
                </a>
                <a href="https://bsky.app/search?q=wordle" target="_blank" class="community-card bluesky">
                    <div class="icon">ü¶ã</div>
                    <div class="info">
                        <h4>Bluesky</h4>
                        <p>Word game community</p>
                    </div>
                </a>
                <a href="https://mastodon.social/tags/wordle" target="_blank" class="community-card mastodon">
                    <div class="icon">üêò</div>
                    <div class="info">
                        <h4>Mastodon</h4>
                        <p>#wordle discussions</p>
                    </div>
                </a>
            </div>

            <div class="section-header" style="margin-top: 30px;">
                <span class="section-title">üì∞ Game News & Updates</span>
            </div>
            <div class="community-grid">
                <a href="https://www.nytimes.com/spotlight/games" target="_blank" class="community-card">
                    <div class="icon" style="background: var(--bg-hover);">üì∞</div>
                    <div class="info">
                        <h4>NY Times Games</h4>
                        <p>Official game updates</p>
                    </div>
                </a>
                <a href="https://www.rockpapershotgun.com/wordle-today" target="_blank" class="community-card">
                    <div class="icon" style="background: var(--bg-hover);">üéÆ</div>
                    <div class="info">
                        <h4>Rock Paper Shotgun</h4>
                        <p>Daily hints & tips</p>
                    </div>
                </a>
                <a href="https://dailygameshub.com" target="_blank" class="community-card">
                    <div class="icon" style="background: var(--bg-hover);">üóÇÔ∏è</div>
                    <div class="info">
                        <h4>Daily Games Hub</h4>
                        <p>Discover more games</p>
                    </div>
                </a>
                <a href="https://www.polygon.com/wordle-guide" target="_blank" class="community-card">
                    <div class="icon" style="background: var(--bg-hover);">üî∑</div>
                    <div class="info">
                        <h4>Polygon</h4>
                        <p>Hints & game guides</p>
                    </div>
                </a>
                <a href="https://www.pcgamer.com/games/puzzle/" target="_blank" class="community-card">
                    <div class="icon" style="background: var(--bg-hover);">üíª</div>
                    <div class="info">
                        <h4>PC Gamer</h4>
                        <p>Puzzle game news</p>
                    </div>
                </a>
                <a href="https://kotaku.com/tag/wordle" target="_blank" class="community-card">
                    <div class="icon" style="background: var(--bg-hover);">üïπÔ∏è</div>
                    <div class="info">
                        <h4>Kotaku</h4>
                        <p>Gaming culture & news</p>
                    </div>
                </a>
            </div>

            <div class="section-header" style="margin-top: 30px;">
                <span class="section-title">üì° RSS Feeds</span>
            </div>
            <p style="color: var(--text-secondary); margin-bottom: 15px; font-size: 0.9rem;">Add these to your RSS reader for daily updates:</p>
            <div class="rss-list">
                <div class="rss-item" onclick="copyToClipboard('https://www.nytimes.com/svc/collections/v1/publish/https://www.nytimes.com/spotlight/games/rss.xml')">
                    <span class="rss-icon">üì∞</span>
                    <div class="rss-info">
                        <div class="rss-name">NY Times Games</div>
                        <div class="rss-url">nytimes.com/.../games/rss.xml</div>
                    </div>
                    <span class="copy-btn">üìã Copy</span>
                </div>
                <div class="rss-item" onclick="copyToClipboard('https://www.rockpapershotgun.com/feed/tag/wordle')">
                    <span class="rss-icon">üéÆ</span>
                    <div class="rss-info">
                        <div class="rss-name">Rock Paper Shotgun - Wordle</div>
                        <div class="rss-url">rockpapershotgun.com/feed/tag/wordle</div>
                    </div>
                    <span class="copy-btn">üìã Copy</span>
                </div>
                <div class="rss-item" onclick="copyToClipboard('https://www.polygon.com/rss/index.xml')">
                    <span class="rss-icon">üî∑</span>
                    <div class="rss-info">
                        <div class="rss-name">Polygon Gaming</div>
                        <div class="rss-url">polygon.com/rss/index.xml</div>
                    </div>
                    <span class="copy-btn">üìã Copy</span>
                </div>
            </div>

            <div class="section-header" style="margin-top: 30px;">
                <span class="section-title">üí¨ Discussion Board</span>
            </div>
            <div class="chat-container" id="chat-container">
                <div class="chat-messages" id="chat-messages"></div>
                <div class="chat-input-container">
                    <input type="text" id="chat-input" placeholder="Share your thoughts, tips, or today's results..." maxlength="280">
                    <button class="btn btn-primary btn-small" onclick="postChatMessage()">Post</button>
                </div>
            </div>
        </div>

        <footer class="footer">
            v1.2.0 ‚Ä¢ Game Shelf
        </footer>
    </div>

    <button class="settings-btn" onclick="showSettingsModal()">‚öôÔ∏è</button>

    <!-- Welcome/Registration Modal -->
    <div class="modal-overlay" id="welcome-modal">
        <div class="modal">
            <h2>üëã Welcome to Game Shelf!</h2>
            <p>Select the daily games you play. We'll help you track your progress and streaks!</p>
            
            <div class="game-list" id="registration-list"></div>
            
            <div class="btn-group">
                <button class="btn btn-primary" onclick="completeRegistration()" style="flex:1">Get Started</button>
                <button class="btn btn-secondary" onclick="skipRegistration()">Skip</button>
            </div>
        </div>
    </div>

    <!-- Add Game Modal -->
    <div class="modal-overlay" id="add-game-modal">
        <div class="modal">
            <h2>‚ûï Add a Game</h2>
            <p>Choose from popular games or add a custom one.</p>
            
            <div class="game-list" id="add-game-list"></div>
            
            <div style="text-align: center; margin: 20px 0; color: var(--text-muted);">‚Äî or add custom ‚Äî</div>
            
            <div class="form-group">
                <label>Game Name</label>
                <input type="text" id="custom-name" placeholder="e.g., Wordle">
            </div>
            <div class="form-group">
                <label>Game URL</label>
                <input type="text" id="custom-url" placeholder="https://...">
            </div>
            <div class="form-group">
                <label>Icon (emoji)</label>
                <input type="text" id="custom-icon" placeholder="üéÆ" maxlength="2">
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" onclick="addSelectedGames()" style="flex:1">Add Games</button>
                <button class="btn btn-secondary" onclick="closeAddGameModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Review Modal -->
    <div class="modal-overlay" id="review-modal">
        <div class="modal">
            <h2>‚≠ê Rate & Review</h2>
            <div id="review-game-header" style="display: flex; align-items: center; gap: 15px; margin-bottom: 20px;">
                <span id="review-game-icon" style="font-size: 2.5rem;"></span>
                <div>
                    <h3 id="review-game-name" style="margin: 0;"></h3>
                </div>
            </div>
            
            <div class="form-group">
                <label>Your Rating</label>
                <div class="star-rating-input" id="rating-input">
                    <span class="star" data-value="1">‚òÖ</span>
                    <span class="star" data-value="2">‚òÖ</span>
                    <span class="star" data-value="3">‚òÖ</span>
                    <span class="star" data-value="4">‚òÖ</span>
                    <span class="star" data-value="5">‚òÖ</span>
                </div>
            </div>
            
            <div class="form-group">
                <label>Notes (optional)</label>
                <textarea id="review-notes" placeholder="Your thoughts on this game..."></textarea>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" onclick="saveReview()" style="flex:1">Save Review</button>
                <button class="btn btn-secondary" onclick="closeReviewModal()">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settings-modal">
        <div class="modal">
            <h2>‚öôÔ∏è Settings</h2>
            
            <div class="form-group">
                <button class="btn btn-secondary" onclick="exportData()" style="width: 100%;">
                    üì§ Export Data
                </button>
            </div>
            
            <div class="form-group">
                <button class="btn btn-secondary" onclick="showWelcome()" style="width: 100%;">
                    üîÑ Re-run Setup
                </button>
            </div>
            
            <div class="form-group">
                <button class="btn btn-secondary" onclick="resetAllData()" style="width: 100%; background: var(--accent-red); color: #fff;">
                    üóëÔ∏è Reset All Data
                </button>
            </div>
            
            <div class="btn-group">
                <button class="btn btn-primary" onclick="closeSettingsModal()" style="flex:1">Done</button>
            </div>
        </div>
    </div>

    <script>
        // ============ DATA ============
        const FEATURED_GAMES = [
            { id: 'rungs', name: 'Rungs', icon: 'ü™ú', url: 'https://rfrbrn.github.io/rungs/rungs.html', featured: true, description: 'Pair words and arrange in order' },
            { id: 'slate', name: 'Slate', icon: 'ü™®', url: 'https://rfrbrn.github.io/slate/slate.html', featured: true, description: 'Fill in consonants to reveal words' },
            { id: 'quotle', name: 'Quotle', icon: 'üí¨', url: 'https://rfrbrn.github.io/quotle/quotle.html', featured: true, description: 'Guess the famous quote' },
            { id: 'wordboxing', name: 'Word Boxing', icon: 'ü•ä', url: 'https://rfrbrn.github.io/wordboxing/wordboxing.html', featured: true, description: 'Multiplayer word battle' }
        ];

        const POPULAR_GAMES = [
            { id: 'wordle', name: 'Wordle', icon: 'üü©', url: 'https://www.nytimes.com/games/wordle/index.html', source: 'NY Times', description: 'Guess the 5-letter word in 6 tries', tags: ['word', 'daily'] },
            { id: 'connections', name: 'Connections', icon: 'üîó', url: 'https://www.nytimes.com/games/connections', source: 'NY Times', description: 'Group 16 words into 4 categories', tags: ['word', 'categories'] },
            { id: 'strands', name: 'Strands', icon: 'üßµ', url: 'https://www.nytimes.com/games/strands', source: 'NY Times', description: 'Find themed words in a letter grid', tags: ['word', 'search'] },
            { id: 'spelling-bee', name: 'Spelling Bee', icon: 'üêù', url: 'https://www.nytimes.com/puzzles/spelling-bee', source: 'NY Times', description: 'Make words using 7 letters', tags: ['word', 'vocabulary'] },
            { id: 'mini', name: 'Mini Crossword', icon: 'üìù', url: 'https://www.nytimes.com/crosswords/game/mini', source: 'NY Times', description: 'Quick daily crossword', tags: ['crossword', 'quick'] },
            { id: 'letterboxed', name: 'Letterboxed', icon: 'üì¶', url: 'https://www.nytimes.com/puzzles/letter-boxed', source: 'NY Times', description: 'Connect letters on a box', tags: ['word', 'puzzle'] },
            { id: 'tiles', name: 'Tiles', icon: 'üÄÑ', url: 'https://www.nytimes.com/puzzles/tiles', source: 'NY Times', description: 'Match tiles to clear the board', tags: ['matching', 'visual'] },
            { id: 'vertex', name: 'Vertex', icon: 'üìê', url: 'https://www.nytimes.com/puzzles/vertex', source: 'NY Times', description: 'Connect dots without crossing', tags: ['logic', 'visual'] },
            { id: 'immaculate-grid', name: 'Immaculate Grid', icon: '‚öæ', url: 'https://www.immaculategrid.com/', source: 'Sports', description: 'Baseball trivia grid', tags: ['sports', 'trivia'] },
            { id: 'costcodle', name: 'Costcodle', icon: 'üõí', url: 'https://costcodle.com/', source: 'Fun', description: 'Guess Costco product prices', tags: ['fun', 'guessing'] },
            { id: 'tradle', name: 'Tradle', icon: 'üö¢', url: 'https://oec.world/en/tradle/', source: 'Geography', description: 'Guess country by exports', tags: ['geography', 'economics'] },
            { id: 'worldle', name: 'Worldle', icon: 'üåç', url: 'https://worldle.teuteuf.fr/', source: 'Geography', description: 'Guess country by outline', tags: ['geography'] },
            { id: 'globle', name: 'Globle', icon: 'üåé', url: 'https://globle-game.com/', source: 'Geography', description: 'Find the mystery country', tags: ['geography'] },
            { id: 'foodguessr', name: 'FoodGuessr', icon: 'üçî', url: 'https://www.foodguessr.com/', source: 'Fun', description: 'Guess food origins', tags: ['food', 'geography'] },
            { id: 'quordle', name: 'Quordle', icon: '4Ô∏è‚É£', url: 'https://www.merriam-webster.com/games/quordle/', source: 'Words', description: 'Solve 4 Wordles at once', tags: ['word', 'challenge'] },
            { id: 'octordle', name: 'Octordle', icon: '8Ô∏è‚É£', url: 'https://octordle.com/', source: 'Words', description: 'Solve 8 Wordles at once', tags: ['word', 'challenge'] },
            { id: 'semantle', name: 'Semantle', icon: 'üß†', url: 'https://semantle.com/', source: 'Words', description: 'Guess by word meaning similarity', tags: ['word', 'AI'] },
            { id: 'redactle', name: 'Redactle', icon: '‚ñà', url: 'https://redactle.net/', source: 'Knowledge', description: 'Guess the Wikipedia article', tags: ['trivia', 'deduction'] },
        ];

        // ============ STATE ============
        let userData = {
            registered: false,
            games: [],
            stats: {},
            reviews: {},
            chatMessages: []
        };

        let currentReviewGameId = null;
        let currentRating = 0;

        // ============ INIT ============
        function init() {
            loadData();
            
            if (!userData.registered) {
                showWelcome();
            }
            
            renderFeaturedGames();
            renderMyGames();
            renderDiscoverList();
            renderReviews();
            updateStats();
            setupStarRating();
        }

        function loadData() {
            const saved = localStorage.getItem('gameShelfData');
            if (saved) {
                userData = JSON.parse(saved);
                // Migrate old data
                if (!userData.reviews) userData.reviews = {};
                if (!userData.chatMessages) userData.chatMessages = [];
            }
        }

        function saveData() {
            localStorage.setItem('gameShelfData', JSON.stringify(userData));
        }

        // ============ TAB NAVIGATION ============
        function switchTab(tabId) {
            // Update tab buttons
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelector(`[onclick="switchTab('${tabId}')"]`).classList.add('active');
            
            // Update content
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(`tab-${tabId}`).classList.add('active');
        }

        // ============ REGISTRATION ============
        function showWelcome() {
            const list = document.getElementById('registration-list');
            list.innerHTML = POPULAR_GAMES.slice(0, 10).map(game => `
                <div class="game-list-item" onclick="toggleRegistrationGame('${game.id}')" data-id="${game.id}">
                    <span class="icon">${game.icon}</span>
                    <div class="info">
                        <div class="name">${game.name}</div>
                        <div class="source">${game.source}</div>
                    </div>
                    <div class="checkbox">‚úì</div>
                </div>
            `).join('');
            
            document.getElementById('welcome-modal').classList.add('active');
        }

        function toggleRegistrationGame(id) {
            const item = document.querySelector(`#registration-list .game-list-item[data-id="${id}"]`);
            item.classList.toggle('selected');
        }

        function completeRegistration() {
            const selected = document.querySelectorAll('#registration-list .game-list-item.selected');
            const selectedIds = Array.from(selected).map(el => el.dataset.id);
            
            selectedIds.forEach(id => {
                const game = POPULAR_GAMES.find(g => g.id === id);
                if (game && !userData.games.find(g => g.id === id)) {
                    userData.games.push({ ...game });
                    userData.stats[id] = { lastPlayed: null, streak: 0, totalPlays: 0 };
                }
            });
            
            userData.registered = true;
            saveData();
            
            document.getElementById('welcome-modal').classList.remove('active');
            renderMyGames();
            renderDiscoverList();
            updateStats();
        }

        function skipRegistration() {
            userData.registered = true;
            saveData();
            document.getElementById('welcome-modal').classList.remove('active');
        }

        // ============ RENDERING ============
        function renderFeaturedGames() {
            const container = document.getElementById('featured-games');
            container.innerHTML = FEATURED_GAMES.map(game => {
                const stats = userData.stats[game.id] || { lastPlayed: null, streak: 0 };
                const playedToday = isToday(stats.lastPlayed);
                const review = userData.reviews[game.id];
                
                return `
                    <div class="featured-card ${playedToday ? 'played-today' : ''}" onclick="playGame('${game.id}', '${game.url}', true)">
                        <span class="featured-badge">RB Games</span>
                        ${playedToday ? '<span class="check-badge">‚úì</span>' : ''}
                        <span class="icon">${game.icon}</span>
                        <div class="name">${game.name}</div>
                        <div class="streak ${stats.streak > 0 ? 'active' : ''}">
                            ${stats.streak > 0 ? 'üî• ' + stats.streak + ' day streak' : 'Start your streak!'}
                        </div>
                        ${review && review.rating ? `<div class="rating">${'‚òÖ'.repeat(review.rating)}${'‚òÜ'.repeat(5-review.rating)}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function renderMyGames() {
            const container = document.getElementById('my-games');
            
            if (userData.games.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <div class="icon">üìö</div>
                        <p>No games added yet.<br>Click "Add Game" to get started!</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = userData.games.map(game => {
                const stats = userData.stats[game.id] || { lastPlayed: null, streak: 0 };
                const playedToday = isToday(stats.lastPlayed);
                const review = userData.reviews[game.id];
                
                return `
                    <div class="game-card ${playedToday ? 'played-today' : ''}" onclick="playGame('${game.id}', '${game.url}')">
                        <button class="remove-btn" onclick="event.stopPropagation(); removeGame('${game.id}')">‚úï</button>
                        ${playedToday ? '<span class="check-badge">‚úì</span>' : ''}
                        <span class="icon">${game.icon}</span>
                        <div class="name">${game.name}</div>
                        <div class="streak ${stats.streak > 0 ? 'active' : ''}">
                            ${stats.streak > 0 ? 'üî• ' + stats.streak : 'No streak'}
                        </div>
                        ${review && review.rating ? `<div class="rating">${'<span class="star filled">‚òÖ</span>'.repeat(review.rating)}${'<span class="star">‚òÖ</span>'.repeat(5-review.rating)}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function renderDiscoverList() {
            const existingIds = [...userData.games.map(g => g.id), ...FEATURED_GAMES.map(g => g.id)];
            const available = POPULAR_GAMES.filter(g => !existingIds.includes(g.id));
            
            const container = document.getElementById('discover-list');
            
            if (available.length === 0) {
                container.innerHTML = `
                    <div class="empty-state" style="grid-column: 1/-1;">
                        <div class="icon">üéâ</div>
                        <p>You've added all the games!<br>Check the Community tab for more.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = available.map(game => `
                <div class="discover-card" onclick="addGameFromDiscover('${game.id}')">
                    <div class="header">
                        <span class="icon">${game.icon}</span>
                        <div>
                            <div class="name">${game.name}</div>
                            <div class="source">${game.source}</div>
                        </div>
                    </div>
                    <div class="description">${game.description}</div>
                    <div class="tags">
                        ${game.tags.map(t => `<span class="tag">${t}</span>`).join('')}
                    </div>
                </div>
            `).join('');
        }

        function renderReviews() {
            const allGames = [...FEATURED_GAMES, ...userData.games];
            const gamesWithStats = allGames.filter(g => userData.stats[g.id] && userData.stats[g.id].totalPlays > 0);
            
            const container = document.getElementById('reviews-list');
            const emptyState = document.getElementById('reviews-empty');
            
            if (gamesWithStats.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }
            
            emptyState.style.display = 'none';
            
            container.innerHTML = gamesWithStats.map(game => {
                const stats = userData.stats[game.id] || {};
                const review = userData.reviews[game.id] || {};
                
                return `
                    <div class="review-card">
                        <div class="review-header">
                            <span class="icon">${game.icon}</span>
                            <div class="info">
                                <h4>${game.name}</h4>
                                <div class="stars">${review.rating ? '‚òÖ'.repeat(review.rating) + '‚òÜ'.repeat(5-review.rating) : '<span style="color: var(--text-muted)">Not rated</span>'}</div>
                            </div>
                            <div style="margin-left: auto; text-align: right; font-size: 0.8rem; color: var(--text-muted);">
                                <div>üî• ${stats.streak || 0} streak</div>
                                <div>üìä ${stats.totalPlays || 0} plays</div>
                            </div>
                        </div>
                        <div class="review-notes" onclick="openReviewModal('${game.id}')">${review.notes || ''}</div>
                        <div class="review-actions">
                            <button class="btn btn-secondary btn-small" onclick="openReviewModal('${game.id}')">‚úèÔ∏è ${review.rating ? 'Edit' : 'Add'} Review</button>
                            <button class="btn btn-secondary btn-small" onclick="playGame('${game.id}', '${game.url}', ${game.featured || false})">‚ñ∂Ô∏è Play</button>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ============ GAME ACTIONS ============
        function playGame(id, url, featured = false) {
            // Initialize stats if needed
            if (!userData.stats[id]) {
                userData.stats[id] = { lastPlayed: null, streak: 0, totalPlays: 0 };
            }
            
            const stats = userData.stats[id];
            const today = getTodayString();
            const yesterday = getYesterdayString();
            
            // Update streak logic
            if (stats.lastPlayed !== today) {
                if (stats.lastPlayed === yesterday) {
                    stats.streak++;
                } else if (stats.lastPlayed !== today) {
                    stats.streak = 1;
                }
                stats.totalPlays++;
                stats.lastPlayed = today;
            }
            
            saveData();
            
            // Re-render and update
            renderFeaturedGames();
            renderMyGames();
            renderReviews();
            updateStats();
            
            // Open game in new tab
            window.open(url, '_blank');
        }

        function removeGame(id) {
            if (!confirm('Remove this game from your shelf?')) return;
            
            userData.games = userData.games.filter(g => g.id !== id);
            delete userData.stats[id];
            delete userData.reviews[id];
            saveData();
            renderMyGames();
            renderDiscoverList();
            renderReviews();
            updateStats();
        }

        function addGameFromDiscover(id) {
            const game = POPULAR_GAMES.find(g => g.id === id);
            if (game && !userData.games.find(g => g.id === id)) {
                userData.games.push({ ...game });
                userData.stats[id] = { lastPlayed: null, streak: 0, totalPlays: 0 };
                saveData();
                renderMyGames();
                renderDiscoverList();
                updateStats();
                
                // Show confirmation
                alert(`${game.icon} ${game.name} added to your shelf!`);
            }
        }

        // ============ ADD GAME ============
        function showAddGameModal() {
            const existingIds = [...userData.games.map(g => g.id), ...FEATURED_GAMES.map(g => g.id)];
            const available = POPULAR_GAMES.filter(g => !existingIds.includes(g.id));
            
            const list = document.getElementById('add-game-list');
            
            if (available.length > 0) {
                list.innerHTML = available.map(game => `
                    <div class="game-list-item" onclick="toggleAddGame('${game.id}')" data-id="${game.id}">
                        <span class="icon">${game.icon}</span>
                        <div class="info">
                            <div class="name">${game.name}</div>
                            <div class="source">${game.source}</div>
                        </div>
                        <div class="checkbox">‚úì</div>
                    </div>
                `).join('');
            } else {
                list.innerHTML = '<p style="text-align:center; color: var(--text-muted);">All popular games added! Use the form below to add custom games.</p>';
            }
            
            // Clear custom inputs
            document.getElementById('custom-name').value = '';
            document.getElementById('custom-url').value = '';
            document.getElementById('custom-icon').value = '';
            
            document.getElementById('add-game-modal').classList.add('active');
        }

        function closeAddGameModal() {
            document.getElementById('add-game-modal').classList.remove('active');
        }

        function toggleAddGame(id) {
            const item = document.querySelector(`#add-game-list .game-list-item[data-id="${id}"]`);
            item.classList.toggle('selected');
        }

        function addSelectedGames() {
            // Add selected popular games
            const selected = document.querySelectorAll('#add-game-list .game-list-item.selected');
            const selectedIds = Array.from(selected).map(el => el.dataset.id);
            
            selectedIds.forEach(id => {
                const game = POPULAR_GAMES.find(g => g.id === id);
                if (game && !userData.games.find(g => g.id === id)) {
                    userData.games.push({ ...game });
                    userData.stats[id] = { lastPlayed: null, streak: 0, totalPlays: 0 };
                }
            });
            
            // Add custom game if filled in
            const customName = document.getElementById('custom-name').value.trim();
            const customUrl = document.getElementById('custom-url').value.trim();
            const customIcon = document.getElementById('custom-icon').value.trim() || 'üéÆ';
            
            if (customName && customUrl) {
                const customId = 'custom-' + Date.now();
                userData.games.push({
                    id: customId,
                    name: customName,
                    url: customUrl,
                    icon: customIcon,
                    source: 'Custom',
                    description: 'Custom game',
                    tags: ['custom']
                });
                userData.stats[customId] = { lastPlayed: null, streak: 0, totalPlays: 0 };
            }
            
            saveData();
            closeAddGameModal();
            renderMyGames();
            renderDiscoverList();
            updateStats();
        }

        // ============ REVIEWS ============
        function setupStarRating() {
            const stars = document.querySelectorAll('#rating-input .star');
            stars.forEach(star => {
                star.addEventListener('click', () => {
                    currentRating = parseInt(star.dataset.value);
                    updateStarDisplay();
                });
                star.addEventListener('mouseenter', () => {
                    highlightStars(parseInt(star.dataset.value));
                });
            });
            
            document.getElementById('rating-input').addEventListener('mouseleave', () => {
                updateStarDisplay();
            });
        }

        function highlightStars(count) {
            const stars = document.querySelectorAll('#rating-input .star');
            stars.forEach((star, i) => {
                star.classList.toggle('filled', i < count);
            });
        }

        function updateStarDisplay() {
            highlightStars(currentRating);
        }

        function openReviewModal(gameId) {
            currentReviewGameId = gameId;
            
            const game = [...FEATURED_GAMES, ...userData.games].find(g => g.id === gameId);
            const review = userData.reviews[gameId] || {};
            
            document.getElementById('review-game-icon').textContent = game.icon;
            document.getElementById('review-game-name').textContent = game.name;
            document.getElementById('review-notes').value = review.notes || '';
            
            currentRating = review.rating || 0;
            updateStarDisplay();
            
            document.getElementById('review-modal').classList.add('active');
        }

        function closeReviewModal() {
            document.getElementById('review-modal').classList.remove('active');
            currentReviewGameId = null;
            currentRating = 0;
        }

        function saveReview() {
            if (!currentReviewGameId) return;
            
            userData.reviews[currentReviewGameId] = {
                rating: currentRating,
                notes: document.getElementById('review-notes').value.trim(),
                updatedAt: new Date().toISOString()
            };
            
            saveData();
            closeReviewModal();
            renderFeaturedGames();
            renderMyGames();
            renderReviews();
        }

        // ============ SETTINGS ============
        function showSettingsModal() {
            document.getElementById('settings-modal').classList.add('active');
        }

        function closeSettingsModal() {
            document.getElementById('settings-modal').classList.remove('active');
        }

        function resetAllData() {
            if (!confirm('This will delete all your games and stats. Are you sure?')) return;
            
            localStorage.removeItem('gameShelfData');
            userData = { registered: false, games: [], stats: {}, reviews: {}, chatMessages: [] };
            
            closeSettingsModal();
            renderFeaturedGames();
            renderMyGames();
            renderDiscoverList();
            renderReviews();
            renderChat();
            updateStats();
            showWelcome();
        }

        function exportData() {
            const dataStr = JSON.stringify(userData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'gameshelf-backup.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // ============ STATS ============
        function updateStats() {
            const today = getTodayString();
            const allStats = { ...userData.stats };
            
            // Count played today
            let playedToday = 0;
            let bestStreak = 0;
            
            Object.values(allStats).forEach(stat => {
                if (stat.lastPlayed === today) playedToday++;
                if (stat.streak > bestStreak) bestStreak = stat.streak;
            });
            
            const totalGames = FEATURED_GAMES.length + userData.games.length;
            
            document.getElementById('today-count').textContent = playedToday;
            document.getElementById('best-streak').textContent = bestStreak;
            document.getElementById('total-games').textContent = totalGames;
            
            // Also update share preview
            updateSharePreview();
        }

        // ============ UTILITIES ============
        function getTodayString() {
            const now = new Date();
            return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
        }

        function getYesterdayString() {
            const now = new Date();
            now.setDate(now.getDate() - 1);
            return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
        }

        function isToday(dateStr) {
            return dateStr === getTodayString();
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 2000);
        }

        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showToast('üìã RSS URL copied!');
            }).catch(() => {
                showToast('Failed to copy');
            });
        }

        // ============ CHAT/DISCUSSION ============
        function renderChat() {
            const container = document.getElementById('chat-messages');
            const messages = userData.chatMessages || [];
            
            if (messages.length === 0) {
                container.innerHTML = `
                    <div class="chat-empty">
                        <p>üí¨ No messages yet!</p>
                        <p style="font-size: 0.8rem;">Share your daily results, tips, or thoughts.</p>
                    </div>
                `;
                return;
            }
            
            container.innerHTML = messages.map((msg, index) => `
                <div class="chat-message">
                    <div class="chat-message-header">
                        <span class="chat-message-time">${formatChatTime(msg.timestamp)}</span>
                        <button class="chat-message-delete" onclick="deleteChatMessage(${index})">üóëÔ∏è</button>
                    </div>
                    <div class="chat-message-text">${escapeHtml(msg.text)}</div>
                </div>
            `).join('');
            
            container.scrollTop = container.scrollHeight;
        }

        function postChatMessage() {
            const input = document.getElementById('chat-input');
            const text = input.value.trim();
            
            if (!text) return;
            
            if (!userData.chatMessages) userData.chatMessages = [];
            
            userData.chatMessages.push({
                text: text,
                timestamp: new Date().toISOString()
            });
            
            // Keep only last 50 messages
            if (userData.chatMessages.length > 50) {
                userData.chatMessages = userData.chatMessages.slice(-50);
            }
            
            saveData();
            input.value = '';
            renderChat();
        }

        function deleteChatMessage(index) {
            if (!confirm('Delete this message?')) return;
            userData.chatMessages.splice(index, 1);
            saveData();
            renderChat();
        }

        function formatChatTime(timestamp) {
            const date = new Date(timestamp);
            const now = new Date();
            const diff = now - date;
            
            if (diff < 60000) return 'Just now';
            if (diff < 3600000) return Math.floor(diff / 60000) + 'm ago';
            if (diff < 86400000) return Math.floor(diff / 3600000) + 'h ago';
            
            return date.toLocaleDateString();
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Handle Enter key in chat
        document.addEventListener('DOMContentLoaded', () => {
            const chatInput = document.getElementById('chat-input');
            if (chatInput) {
                chatInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        postChatMessage();
                    }
                });
            }
        });

        // ============ SHARE SHELF ============
        function updateSharePreview() {
            const today = getTodayString();
            const allStats = { ...userData.stats };
            
            let playedToday = 0;
            let bestStreak = 0;
            
            Object.values(allStats).forEach(stat => {
                if (stat.lastPlayed === today) playedToday++;
                if (stat.streak > bestStreak) bestStreak = stat.streak;
            });
            
            const totalGames = FEATURED_GAMES.length + userData.games.length;
            
            // Update share preview stats
            document.getElementById('share-played').textContent = playedToday;
            document.getElementById('share-streak').textContent = bestStreak;
            document.getElementById('share-total').textContent = totalGames;
            document.getElementById('share-date').textContent = new Date().toLocaleDateString('en-US', { weekday: 'long', month: 'short', day: 'numeric', year: 'numeric' });
            
            // Show games in share preview
            const allGames = [...FEATURED_GAMES, ...userData.games].slice(0, 8);
            document.getElementById('share-games').innerHTML = allGames.map(game => {
                const stats = userData.stats[game.id] || { streak: 0 };
                const playedToday = isToday(stats.lastPlayed);
                return `
                    <div class="share-game-item" style="${playedToday ? 'border: 2px solid var(--accent-green);' : ''}">
                        <span class="icon">${game.icon}</span>
                        <div class="name">${game.name}</div>
                        ${stats.streak > 0 ? `<div class="streak">üî•${stats.streak}</div>` : ''}
                    </div>
                `;
            }).join('');
        }

        function shareAsText() {
            const today = getTodayString();
            const allStats = { ...userData.stats };
            
            let playedToday = 0;
            let bestStreak = 0;
            
            Object.values(allStats).forEach(stat => {
                if (stat.lastPlayed === today) playedToday++;
                if (stat.streak > bestStreak) bestStreak = stat.streak;
            });
            
            const totalGames = FEATURED_GAMES.length + userData.games.length;
            const allGames = [...FEATURED_GAMES, ...userData.games];
            
            let text = `üéÆ My Game Shelf\n`;
            text += `${new Date().toLocaleDateString()}\n\n`;
            text += `üìä Today: ${playedToday}/${totalGames} | üî• Best Streak: ${bestStreak}\n\n`;
            
            const playedGames = allGames.filter(g => allStats[g.id] && isToday(allStats[g.id].lastPlayed));
            if (playedGames.length > 0) {
                text += `‚úÖ Played: ${playedGames.map(g => g.icon).join(' ')}\n`;
            }
            
            text += `\nüéØ gameshelf.app`;
            
            navigator.clipboard.writeText(text).then(() => {
                showToast('üìã Copied to clipboard!');
            });
        }

        function shareNative() {
            const today = getTodayString();
            const allStats = { ...userData.stats };
            
            let playedToday = 0;
            let bestStreak = 0;
            
            Object.values(allStats).forEach(stat => {
                if (stat.lastPlayed === today) playedToday++;
                if (stat.streak > bestStreak) bestStreak = stat.streak;
            });
            
            const totalGames = FEATURED_GAMES.length + userData.games.length;
            
            const shareData = {
                title: 'My Game Shelf',
                text: `üéÆ Game Shelf - ${playedToday}/${totalGames} played today! Best streak: ${bestStreak}üî•`,
                url: 'https://gameshelf.app'
            };
            
            if (navigator.share) {
                navigator.share(shareData).catch(() => {});
            } else {
                shareAsText();
            }
        }

        async function shareAsImage() {
            const preview = document.getElementById('share-preview');
            
            try {
                // Use html2canvas if available, otherwise fallback
                if (typeof html2canvas !== 'undefined') {
                    const canvas = await html2canvas(preview, {
                        backgroundColor: '#1a1a2e',
                        scale: 2
                    });
                    
                    canvas.toBlob((blob) => {
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'gameshelf-' + getTodayString() + '.png';
                        a.click();
                        URL.revokeObjectURL(url);
                        showToast('üì∑ Image saved!');
                    });
                } else {
                    // Fallback: copy text instead
                    showToast('üìã Copying text instead...');
                    shareAsText();
                }
            } catch (err) {
                shareAsText();
            }
        }

        // ============ INIT ============
        init();

        function init() {
            loadData();
            
            if (!userData.registered) {
                showWelcome();
            }
            
            renderFeaturedGames();
            renderMyGames();
            renderDiscoverList();
            renderReviews();
            renderChat();
            updateStats();
            updateSharePreview();
            setupStarRating();
        }

        // Close modals on overlay click
        document.querySelectorAll('.modal-overlay').forEach(modal => {
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });
    </script>
</body>
</html>
